var w=Object.defineProperty;var f=(a,e,t)=>e in a?w(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>f(a,typeof e!="symbol"?e+"":e,t);import{E as C,S as y,A as L,V as n,H as E,D as v,a as b,C as A,M as l,b as m,c as o,d as M,G as I,e as d,f as g,g as p}from"./babylon-DCMw87le.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();class O{constructor(e){c(this,"engine");c(this,"scene");c(this,"camera");c(this,"highlightLayer");c(this,"glowLayer");c(this,"components",new Map);c(this,"isAutoRotating",!1);try{this.engine=new C(e,!0),this.scene=new y(this.engine),this.setupCamera(e),this.setupLighting(),this.setupEnvironment(),this.setupPostProcessing(),this.createComponents(),this.setupInteractions(),this.setupControls(),this.startRenderLoop(),this.hideLoading()}catch(t){console.error("Initialization failed:",t),this.showError("初始化失败，请刷新页面重试")}}setupCamera(e){this.camera=new L("camera",-Math.PI/2,Math.PI/3,25,n.Zero(),this.scene),this.camera.setTarget(n.Zero()),this.camera.attachControl(e),this.camera.lowerRadiusLimit=8,this.camera.upperRadiusLimit=50}setupLighting(){const e=new E("ambientLight",new n(0,1,0),this.scene);e.intensity=.3;const t=new v("directionalLight",new n(-1,-1,-1),this.scene);t.intensity=.8,t.position=new n(10,10,10);const r=new b(2048,t);r.useBlurExponentialShadowMap=!0}setupEnvironment(){this.scene.clearColor=new A(.02,.02,.08,1);const e=l.CreateSphere("skybox",{diameter:100},this.scene),t=new m("skyboxMaterial",this.scene);t.backFaceCulling=!1,t.emissiveColor=new o(.05,.05,.15),e.material=t,e.infiniteDistance=!0}setupPostProcessing(){this.highlightLayer=new M("highlightLayer",this.scene),this.glowLayer=new I("glowLayer",this.scene),this.glowLayer.intensity=.5}createComponents(){this.createComponent("核心服务器",new n(0,0,0),"server"),this.createComponent("数据库",new n(0,-4,0),"database"),this.createComponent("API网关",new n(0,4,0),"api"),this.createComponent("安全模块",new n(-4,0,4),"security"),this.createComponent("区块链节点",new n(0,0,-6),"blockchain"),this.createComponent("用户界面",new n(0,8,0),"interface"),this.createConnectionLines()}createComponent(e,t,r){let i;const s=new m(e+"Material",this.scene);switch(r){case"server":i=l.CreateBox(e,{size:2},this.scene),s.diffuseColor=new o(.2,.4,.8),s.emissiveColor=new o(.1,.2,.4);break;case"database":i=l.CreateCylinder(e,{height:2,diameter:2},this.scene),s.diffuseColor=new o(.1,.6,.2),s.emissiveColor=new o(.05,.3,.1);break;case"api":i=l.CreateSphere(e,{diameter:2},this.scene),s.diffuseColor=new o(.8,.4,.1),s.emissiveColor=new o(.4,.2,.05);break;case"security":i=l.CreatePolyhedron(e,{size:1.5},this.scene),s.diffuseColor=new o(.8,.1,.1),s.emissiveColor=new o(.4,.05,.05);break;case"blockchain":i=l.CreateIcoSphere(e,{radius:1.5},this.scene),s.diffuseColor=new o(.8,.6,.1),s.emissiveColor=new o(.4,.3,.05);break;case"interface":i=l.CreateBox(e,{width:3,height:.5,depth:2},this.scene),s.diffuseColor=new o(.4,.2,.8),s.emissiveColor=new o(.2,.1,.4);break;default:i=l.CreateBox(e,{size:2},this.scene),s.diffuseColor=new o(.5,.5,.5)}i.position=t,i.material=s;const h=new d("floatingAnimation","position.y",30,d.ANIMATIONTYPE_FLOAT,d.ANIMATIONLOOPMODE_CYCLE),u=[];return u.push({frame:0,value:t.y}),u.push({frame:60,value:t.y+.3}),u.push({frame:120,value:t.y}),h.setKeys(u),i.animations.push(h),this.scene.beginAnimation(i,0,120,!0),this.components.set(e,{mesh:i,name:e,description:`${e}组件`}),i}createConnectionLines(){[[n.Zero(),new n(0,-4,0)],[n.Zero(),new n(0,4,0)],[n.Zero(),new n(-4,0,4)],[n.Zero(),new n(0,0,-6)],[new n(0,4,0),new n(0,8,0)]].forEach((t,r)=>{const i=l.CreateLines(`connection${r}`,{points:t},this.scene),s=new m(`lineMaterial${r}`,this.scene);s.emissiveColor=new o(0,.8,1),s.alpha=.8,i.material=s,i.isPickable=!1})}setupInteractions(){this.components.forEach(e=>{const t=e.mesh;t.actionManager=new g(this.scene),t.actionManager.registerAction(new p(g.OnPointerOverTrigger,()=>{this.highlightLayer.addMesh(t,new o(0,1,1)),this.showTooltip(e.name,e.description)})),t.actionManager.registerAction(new p(g.OnPointerOutTrigger,()=>{this.highlightLayer.removeMesh(t),this.hideTooltip()})),t.actionManager.registerAction(new p(g.OnPickTrigger,()=>{this.showDetailPanel(e)}))})}showTooltip(e,t){console.log(`Tooltip: ${e} - ${t}`)}hideTooltip(){console.log("Hide tooltip")}showDetailPanel(e){console.log(`Detail panel for: ${e.name}`)}setupControls(){const e=document.getElementById("resetCamera"),t=document.getElementById("autoRotate"),r=document.getElementById("toggleWireframe");e?.addEventListener("click",()=>this.resetCamera()),t?.addEventListener("click",()=>this.toggleAutoRotation()),r?.addEventListener("click",()=>this.toggleWireframe())}resetCamera(){d.CreateAndStartAnimation("cameraReset",this.camera,"alpha",30,30,this.camera.alpha,-Math.PI/2,d.ANIMATIONLOOPMODE_CONSTANT)}toggleAutoRotation(){this.isAutoRotating=!this.isAutoRotating;const e=document.getElementById("autoRotate");e&&(e.textContent=this.isAutoRotating?"停止旋转":"自动旋转")}toggleWireframe(){this.scene.meshes.forEach(e=>{e.material&&e.name!=="skybox"&&(e.material.wireframe=!e.material.wireframe)})}startRenderLoop(){this.engine.runRenderLoop(()=>{this.isAutoRotating&&(this.camera.alpha+=.01),this.scene.render()}),window.addEventListener("resize",()=>{this.engine.resize()})}hideLoading(){const e=document.getElementById("loading");e&&(e.style.display="none")}showError(e){const t=document.getElementById("loading");t&&(t.textContent=e,t.style.color="#ff6b6b")}dispose(){this.scene.dispose(),this.engine.dispose()}}class P{constructor(){c(this,"visualization",null);this.init()}async init(){try{const e=document.getElementById("renderCanvas");if(!e)throw new Error("Canvas element not found");this.visualization=new O(e),console.log("3D托管钱包架构图已成功加载")}catch(e){console.error("初始化失败:",e),this.showError("初始化失败，请刷新页面重试")}}showError(e){const t=document.getElementById("loading");t&&(t.textContent=e,t.style.color="#ff6b6b")}dispose(){this.visualization&&(this.visualization.dispose(),this.visualization=null)}}document.addEventListener("DOMContentLoaded",()=>{const a=new P;window.addEventListener("beforeunload",()=>{a.dispose()})});
//# sourceMappingURL=index-5psz-gv5.js.map
